import React, { useState, useEffect, useRef } from 'react'
import { gsap } from 'gsap'
import Navigation from './Navigation/Navigation'
import './Header.css'

function Header() {
  const [isMenuOpen, setIsMenuOpen] = useState(false)
  const line1Ref = useRef(null)
  const line2Ref = useRef(null)

  const handleMenuToggle = () => {
    setIsMenuOpen(!isMenuOpen)
  }

  const handleMenuClose = () => {
    setIsMenuOpen(false)
  }

  useEffect(() => {
    const line1 = line1Ref.current
    const line2 = line2Ref.current
    if (!line1 || !line2) return

    if (isMenuOpen) {
      // クロス状態にアニメーション
      gsap.to(line1, {
        attr: {
          x1: 0.298234,
          y1: 22.8257,
          x2: 34.7694,
          y2: 29.8257
        },
        duration: 0.3,
        ease: 'power2.out'
      })
      gsap.to(line2, {
        attr: {
          x1: 0.0999687,
          y1: 29.8255,
          x2: 34.8406,
          y2: 22.8255
        },
        duration: 0.3,
        ease: 'power2.out'
      })
    } else {
      // 並行状態にアニメーション
      gsap.to(line1, {
        attr: {
          x1: 0.19873,
          y1: 22.8157,
          x2: 34.9393,
          y2: 22.8157
        },
        duration: 0.3,
        ease: 'power2.out'
      })
      gsap.to(line2, {
        attr: {
          x1: 0.19873,
          y1: 29.8157,
          x2: 34.9393,
          y2: 29.8157
        },
        duration: 0.3,
        ease: 'power2.out'
      })
    }
  }, [isMenuOpen])

  return (
    <>
      <div className="header-status-bar-guard"></div>
      <header className={`header ${isMenuOpen ? 'open' : ''}`}>
        <div className="header-container">
          <div className="header-left">
            <div className="header-logo">
              <img src="/necowa-logo.svg" alt="Necowa" />
            </div>
            <p className="header-catchcopy">渋谷の保護ネココワーキングスペース</p>
          </div>
          <button
            className={`header-hamburger ${isMenuOpen ? 'header-hamburger--open' : ''}`}
            onClick={handleMenuToggle}
            aria-label="メニュー"
            aria-expanded={isMenuOpen}
          >
            <svg 
              width="36" 
              height="31" 
              viewBox="0 0 36 31" 
              fill="none" 
              xmlns="http://www.w3.org/2000/svg"
            >
              <g className="header-hamburger-lines">
                <line 
                  ref={line1Ref}
                  className="header-hamburger-line header-hamburger-line--1"
                  x1="0.19873" 
                  y1="22.8157" 
                  x2="34.9393" 
                  y2="22.8157" 
                  stroke="#fff"
                  strokeWidth="1"
                />
                <line 
                  ref={line2Ref}
                  className="header-hamburger-line header-hamburger-line--2"
                  x1="0.19873" 
                  y1="29.8157" 
                  x2="34.9393" 
                  y2="29.8157" 
                  stroke="#fff"
                  strokeWidth="1"
                />
              </g>
              <path 
                d="M0.428467 16.1771L10.007 0.257782L10.546 5.12203L14.5942 2.07974L13.2448 8.21746C13.2448 8.21746 17.4941 2.34924 25.7233 4.30595C32.5841 5.93622 34.6699 12.518 34.6699 16.1771" 
                stroke="#fff" 
                strokeLinejoin="bevel"
              />
              <path 
                d="M5.545 16.3157V10.8857H6.295L6.385 11.6757H6.405C6.645 11.4157 6.905 11.1957 7.185 11.0157C7.47167 10.8357 7.775 10.7457 8.095 10.7457C8.515 10.7457 8.84167 10.839 9.075 11.0257C9.30833 11.2123 9.48167 11.4657 9.595 11.7857C9.88167 11.479 10.1683 11.229 10.455 11.0357C10.7483 10.8423 11.0617 10.7457 11.395 10.7457C11.9483 10.7457 12.3583 10.929 12.625 11.2957C12.8983 11.6557 13.035 12.1823 13.035 12.8757V16.3157H12.125V12.9957C12.125 12.4823 12.0417 12.1123 11.875 11.8857C11.715 11.659 11.4617 11.5457 11.115 11.5457C10.9083 11.5457 10.6917 11.6157 10.465 11.7557C10.245 11.889 10.005 12.0957 9.745 12.3757V16.3157H8.835V12.9957C8.835 12.4823 8.75167 12.1123 8.585 11.8857C8.425 11.659 8.17167 11.5457 7.825 11.5457C7.61833 11.5457 7.40167 11.6157 7.175 11.7557C6.94833 11.889 6.71167 12.0957 6.465 12.3757V16.3157H5.545ZM17.0028 16.4457C16.5161 16.4457 16.0761 16.3323 15.6828 16.1057C15.2895 15.879 14.9761 15.5557 14.7428 15.1357C14.5161 14.709 14.4028 14.199 14.4028 13.6057C14.4028 13.159 14.4695 12.7623 14.6028 12.4157C14.7361 12.0623 14.9161 11.7623 15.1428 11.5157C15.3761 11.2623 15.6395 11.0723 15.9328 10.9457C16.2261 10.8123 16.5261 10.7457 16.8328 10.7457C17.2995 10.7457 17.6928 10.849 18.0128 11.0557C18.3328 11.2623 18.5761 11.559 18.7428 11.9457C18.9161 12.3257 19.0028 12.7757 19.0028 13.2957C19.0028 13.3957 18.9995 13.489 18.9928 13.5757C18.9861 13.6623 18.9761 13.7423 18.9628 13.8157H15.3028C15.3228 14.2023 15.4095 14.539 15.5628 14.8257C15.7228 15.1057 15.9328 15.3257 16.1928 15.4857C16.4528 15.639 16.7561 15.7157 17.1028 15.7157C17.3695 15.7157 17.6095 15.679 17.8228 15.6057C18.0428 15.5257 18.2561 15.419 18.4628 15.2857L18.7828 15.8957C18.5495 16.049 18.2861 16.179 17.9928 16.2857C17.6995 16.3923 17.3695 16.4457 17.0028 16.4457ZM15.2928 13.1657H18.2028C18.2028 12.619 18.0828 12.2023 17.8428 11.9157C17.6095 11.6223 17.2795 11.4757 16.8528 11.4757C16.5995 11.4757 16.3595 11.5423 16.1328 11.6757C15.9128 11.809 15.7261 11.999 15.5728 12.2457C15.4261 12.4923 15.3328 12.799 15.2928 13.1657ZM20.3399 16.3157V10.8857H21.0899L21.1799 11.6757H21.1999C21.4599 11.4157 21.7333 11.1957 22.0199 11.0157C22.3133 10.8357 22.6466 10.7457 23.0199 10.7457C23.5933 10.7457 24.0133 10.929 24.2799 11.2957C24.5466 11.6557 24.6799 12.1823 24.6799 12.8757V16.3157H23.7699V12.9957C23.7699 12.4823 23.6866 12.1123 23.5199 11.8857C23.3599 11.659 23.0999 11.5457 22.7399 11.5457C22.4599 11.5457 22.2099 11.6157 21.9899 11.7557C21.7699 11.8957 21.5266 12.1023 21.2599 12.3757V16.3157H20.3399ZM28.0334 16.4457C27.4601 16.4457 27.0368 16.2657 26.7634 15.9057C26.4968 15.5457 26.3634 15.019 26.3634 14.3257V10.8857H27.2834V14.2157C27.2834 14.7157 27.3634 15.0823 27.5234 15.3157C27.6834 15.5423 27.9434 15.6557 28.3034 15.6557C28.5834 15.6557 28.8334 15.5823 29.0534 15.4357C29.2734 15.289 29.5134 15.0557 29.7734 14.7357V10.8857H30.6834V16.3157H29.9234L29.8534 15.4657H29.8234C29.5701 15.759 29.3001 15.9957 29.0134 16.1757C28.7334 16.3557 28.4068 16.4457 28.0334 16.4457Z" 
                fill="#fff"
              />
            </svg>
          </button>
        </div>
      </header>
      <Navigation isOpen={isMenuOpen} onClose={handleMenuClose} />
    </>
  )
}

export default Header

